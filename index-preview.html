<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
    <meta charset="utf-8">
    <meta name="generator" content="quarto-1.6.33">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

    <meta name="author" content="Travis Zalesky">
    <meta name="dcterms.date" content="2024-11-07">
    <meta name="keywords" content="Arizona Tri University Recharge (ATUR), water table, ground water">

    <title>Arizona Aquifer Recharge Suitability Analysis</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.columns{display: flex; gap: min(4vw, 1.5em);}
      div.column{flex: auto; overflow-x: auto;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
        vertical-align: middle;
      }
      /* CSS for syntax highlighting */
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
        }
      pre.numberSource { margin-left: 3em;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
    </style>

    <style>
      body.hypothesis-enabled #quarto-embed-header {
        padding-right: 36px;
      }

      #quarto-embed-header {
        height: 3em;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: solid 1px;
      }

      #quarto-embed-header h6 {
        font-size: 1.1em;
        padding-top: 0.6em;
        margin-left: 1em;
        margin-right: 1em;
        font-weight: 400;
      }

      #quarto-embed-header a.quarto-back-link,
      #quarto-embed-header a.quarto-download-embed {
        font-size: 0.8em;
        margin-top: 1em;
        margin-bottom: 1em;
        margin-left: 1em;
        margin-right: 1em;
      }

      .quarto-back-container {
        padding-left: 0.5em;
        display: flex;
      }

      .headroom {
          will-change: transform;
          transition: transform 200ms linear;
      }

      .headroom--pinned {
          transform: translateY(0%);
      }

      .headroom--unpinned {
          transform: translateY(-100%);
      }      
    </style>

    <script>
    window.document.addEventListener("DOMContentLoaded", function () {

      var header = window.document.querySelector("#quarto-embed-header");
      const titleBannerEl = window.document.querySelector("body > #title-block-header");
      if (titleBannerEl) {
        titleBannerEl.style.paddingTop = header.clientHeight + "px";
      }
      const contentEl = window.document.getElementById('quarto-content');
      for (const child of contentEl.children) {
        child.style.paddingTop = header.clientHeight + "px";
        child.style.marginTop = "1em";
      }

      // Use the article root if the `back` call doesn't work. This isn't perfect
      // but should typically work
      window.quartoBackToArticle = () => {
        var currentUrl = window.location.href;
        window.history.back();
        setTimeout(() => {
            // if location was not changed in 100 ms, then there is no history back
            if(currentUrl === window.location.href){              
                // redirect to site root
                window.location.href = "index.html";
            }
        }, 100);
      }

      const headroom = new window.Headroom(header, {
        tolerance: 5,
        onPin: function () {
        },
        onUnpin: function () {
        },
      });
      headroom.init();
    });
    </script>

    
<script src="site_libs/manuscript-notebook/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-07ba0ad10f5680c660e360ac31d2f3b6.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-27262f0026302d056883bfd2faaf8757.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
     <script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>  
      <meta name="citation_title" content="Arizona Aquifer Recharge Suitability Analysis">
<meta name="citation_abstract" content="Aquifer recharge can be either passive or active, and is implemented in a variety of ways. This analysis seeks to identify regions across AZ which are boadly suitable for aquifer recharge projects as a general template for more focused analysis.
">
<meta name="citation_keywords" content="Arizona Tri University Recharge (ATUR),water table,ground water">
<meta name="citation_author" content="Travis Zalesky">
<meta name="citation_publication_date" content="2024-11-07">
<meta name="citation_cover_date" content="2024-11-07">
<meta name="citation_year" content="2024">
<meta name="citation_online_date" content="2024-11-07">
<meta name="citation_language" content="en">
<meta name="citation_reference" content="citation_title=Strategies for the development of volcanic hazard maps in monogenetic volcanic fields: The example of La Palma (Canary Islands);,citation_author=José Marrero;,citation_author=Alicia García;,citation_author=Manuel Berrocoso;,citation_author=Ángeles Llinares;,citation_author=Antonio Rodríguez-Losada;,citation_author=R. Ortiz;,citation_publication_date=2019-07;,citation_cover_date=2019-07;,citation_year=2019;,citation_doi=10.1186/s13617-019-0085-5;,citation_volume=8;,citation_journal_title=Journal of Applied Volcanology;">
</head>

  <body class="quarto-notebook">
    <div id="quarto-embed-header" class="headroom fixed-top bg-primary">
      
      <a onclick="window.quartoBackToArticle(); return false;" class="btn btn-primary quarto-back-link" href=""><i class="bi bi-caret-left"></i> Back to Article</a>
      <h6><i class="bi bi-journal-code"></i> Article Notebook</h6>

            <a href="./index.qmd" class="btn btn-primary quarto-download-embed" download="index.qmd">Download Source</a>
          </div>

     <header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Arizona Aquifer Recharge Suitability Analysis</h1>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
            <div class="quarto-title-meta-author">
          <div class="quarto-title-meta-heading">Author</div>
          <div class="quarto-title-meta-heading">Affiliation</div>
          
                <div class="quarto-title-meta-contents">
            <p class="author">Travis Zalesky <a href="mailto:travisz@arizona.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0009-0006-0181-3099" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        University of Arizona
                      </p>
                  </div>
                    </div>
        
        <div class="quarto-title-meta">

                      
                <div>
            <div class="quarto-title-meta-heading">Published</div>
            <div class="quarto-title-meta-contents">
              <p class="date">November 7, 2024</p>
            </div>
          </div>
          
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      </div>
    </div>

    <div>
      <div class="abstract">
        <div class="block-title">Abstract</div>
        <p>Aquifer recharge can be either passive or active, and is implemented in a variety of ways. This analysis seeks to identify regions across AZ which are boadly suitable for aquifer recharge projects as a general template for more focused analysis.</p>
      </div>
    </div>

    <div>
      <div class="keywords">
        <div class="block-title">Keywords</div>
        <p>Arizona Tri University Recharge (ATUR), water table, ground water</p>
      </div>
    </div>

    <div class="quarto-other-links-text-target">
    </div>  </div>
</header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#sec-data-methods" id="toc-sec-data-methods" class="nav-link" data-scroll-target="#sec-data-methods"><span class="header-section-number">2</span> Data &amp; Methods</a>
  <ul class="collapse">
  <li><a href="#elevation" id="toc-elevation" class="nav-link" data-scroll-target="#elevation"><span class="header-section-number">2.1</span> Elevation</a></li>
  <li><a href="#precipitation" id="toc-precipitation" class="nav-link" data-scroll-target="#precipitation"><span class="header-section-number">2.2</span> Precipitation</a></li>
  <li><a href="#vegetation-characteristics" id="toc-vegetation-characteristics" class="nav-link" data-scroll-target="#vegetation-characteristics"><span class="header-section-number">2.3</span> Vegetation Characteristics</a></li>
  <li><a href="#soil-hydrology" id="toc-soil-hydrology" class="nav-link" data-scroll-target="#soil-hydrology"><span class="header-section-number">2.4</span> Soil Hydrology</a></li>
  <li><a href="#depth-to-bedrock" id="toc-depth-to-bedrock" class="nav-link" data-scroll-target="#depth-to-bedrock"><span class="header-section-number">2.5</span> Depth to Bedrock</a></li>
  <li><a href="#other-data-layers-for-consideration" id="toc-other-data-layers-for-consideration" class="nav-link" data-scroll-target="#other-data-layers-for-consideration"><span class="header-section-number">2.6</span> Other Data Layers for Consideration</a></li>
  </ul></li>
  <li><a href="#sec-conclusions" id="toc-sec-conclusions" class="nav-link" data-scroll-target="#sec-conclusions"><span class="header-section-number">3</span> Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">      

       <section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
</section>
<section id="sec-data-methods" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="sec-data-methods"><span class="header-section-number">2</span> Data &amp; Methods</h2>
<p><strong>These methods and data layers are preliminary and subject to change</strong></p>
<section id="elevation" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="elevation"><span class="header-section-number">2.1</span> Elevation</h3>
<section id="dem" class="level4" data-number="2.1.1">
<h4 data-number="2.1.1" class="anchored" data-anchor-id="dem"><span class="header-section-number">2.1.1</span> DEM</h4>
<p>Elevation and elevation derivatives from 30-m NASA SRTM. USGS 3-DEM (10m) product not suitable for full study area analysis due to (1) the large area of missing data in Mexico, and (2), the excessively high spatial resolution (massively increasing computational requirements).</p>
<p>SRTM elevation sinks filled prior to calculating slope and aspect.</p>
<p><strong>Should elevation be directly used in the suitability analysis?</strong></p>
</section>
<section id="slope" class="level4" data-number="2.1.2">
<h4 data-number="2.1.2" class="anchored" data-anchor-id="slope"><span class="header-section-number">2.1.2</span> Slope</h4>
<p>Slope derived from hydrologically conditioned (filled) 30-m SRTM layer using quadratic surface function and a fixed 30-m neighborhood. Slope measured in °.</p>
<blockquote class="blockquote">
<p>Higher slopes are less suitable because thinning is both more expensive and more precipitation will end up as runoff.</p>
</blockquote>
<p>Slope classified from 1-10 using a <strong>continuous function</strong> in ArcPro Suitability Mapper.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">Pamameter</th>
<th style="text-align: center;">Setting</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Function</td>
<td style="text-align: center;"><a href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-analyst/the-transformation-functions-available-for-rescale-by-function.htm#ESRI_SECTION1_6C2FDA23D8094B8F99DBF3DF5E176B1D">MSSSmall</a></td>
</tr>
<tr class="even">
<td style="text-align: center;">Mean multiplyer</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Sddv multiplier</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="even">
<td style="text-align: center;">Lower threshold</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Value below threshold</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">Upper threshold</td>
<td style="text-align: center;">90</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Value above threshold</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">Invert function</td>
<td style="text-align: center;">FALSE</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Save transformed dataset</td>
<td style="text-align: center;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: center;">Output</td>
<td style="text-align: center;">Transformed_SRTM_slope</td>
</tr>
</tbody>
</table>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/SuitabilityAnalysis_Transformations/Slope.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Slope suitability mapper rescale transformation setup."><img src="images/SuitabilityAnalysis_Transformations/Slope.png" class="img-fluid figure-img" alt="Slope suitability mapper rescale transformation setup."></a></p>
<figcaption>Slope suitability mapper rescale transformation setup.</figcaption>
</figure>
</div>
</section>
<section id="aspect" class="level4" data-number="2.1.3">
<h4 data-number="2.1.3" class="anchored" data-anchor-id="aspect"><span class="header-section-number">2.1.3</span> Aspect</h4>
<p>Aspect calculated as with slope. Aspect reference point at N. Pole.</p>
<blockquote class="blockquote">
<p>Aspect has a large impact on solar radiation.</p>
</blockquote>
<blockquote class="blockquote">
<p>Closer to 0 or 360 is desired, low suitability scores for closeness.</p>
</blockquote>
<p>Aspect classified from 1-10 using a <strong>continuous function</strong> in ArcPro Suitability Mapper.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">Pamameter</th>
<th style="text-align: center;">Setting</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Function</td>
<td style="text-align: center;"><a href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-analyst/the-transformation-functions-available-for-rescale-by-function.htm#ESRI_SECTION1_A7FC2FC126CD4A41974C8D3F5E0F8FD6">Near</a></td>
</tr>
<tr class="even">
<td style="text-align: center;">Mid Point</td>
<td style="text-align: center;">180</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Point spread</td>
<td style="text-align: center;">0.0011049638968393428 (default)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Lower threshold</td>
<td style="text-align: center;">-1 (flat)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Value below threshold</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">Upper threshold</td>
<td style="text-align: center;">360</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Value above threshold</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">Invert function</td>
<td style="text-align: center;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Save transformed dataset</td>
<td style="text-align: center;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: center;">Output</td>
<td style="text-align: center;">Transformed_SRTM_aspect</td>
</tr>
</tbody>
</table>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/SuitabilityAnalysis_Transformations/Aspect.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Aspect suitability mapper rescale transformation setup."><img src="images/SuitabilityAnalysis_Transformations/Aspect.png" class="img-fluid figure-img" alt="Aspect suitability mapper rescale transformation setup."></a></p>
<figcaption>Aspect suitability mapper rescale transformation setup.</figcaption>
</figure>
</div>
</section>
</section>
<section id="precipitation" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="precipitation"><span class="header-section-number">2.2</span> Precipitation</h3>
<p>PRISM normals, 800m resolution. Annual precipitation.</p>
<blockquote class="blockquote">
<p>Mean annual precipitation must be higher than 500mm 1990 - 2020</p>
</blockquote>
<p>Precipitation classified from 1-10 using a <strong>continuous function</strong> in ArcPro Suitability Mapper.</p>
<p>NOTE: The logistic growth function may also be a good choice for this dataset. See <a href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-analyst/the-transformation-functions-available-for-rescale-by-function.htm#ESRI_SECTION1_76ED0A2D02A24C95B98B8A691603F2F4">Logistic Growth function</a></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">Pamameter</th>
<th style="text-align: center;">Setting</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Function</td>
<td style="text-align: center;"><a href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-analyst/the-transformation-functions-available-for-rescale-by-function.htm#ESRI_SECTION1_B83C9047549542DE995823E6030A29F3">MSLarge</a></td>
</tr>
<tr class="even">
<td style="text-align: center;">Mean multiplyer</td>
<td style="text-align: center;">1.68 (aproximates 500mm at x-intercept)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Sddv multiplier</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">Lower threshold</td>
<td style="text-align: center;">67.33789825439453 (default, minimum)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Value below threshold</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">Upper threshold</td>
<td style="text-align: center;">1214.5689697265625 (default, maximum)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Value above threshold</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">Invert function</td>
<td style="text-align: center;">FALSE</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Save transformed dataset</td>
<td style="text-align: center;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: center;">Output</td>
<td style="text-align: center;">Transformed_PRISM_ppt_30yrnormal_800m</td>
</tr>
</tbody>
</table>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/SuitabilityAnalysis_Transformations/Precip_PRISM.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Aspect suitability mapper rescale transformation setup."><img src="images/SuitabilityAnalysis_Transformations/Precip_PRISM.png" class="img-fluid figure-img" alt="Aspect suitability mapper rescale transformation setup."></a></p>
<figcaption>Aspect suitability mapper rescale transformation setup.</figcaption>
</figure>
</div>
</section>
<section id="vegetation-characteristics" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="vegetation-characteristics"><span class="header-section-number">2.3</span> Vegetation Characteristics</h3>
<section id="nlcd-2021-total-canopy-cover" class="level4" data-number="2.3.1">
<h4 data-number="2.3.1" class="anchored" data-anchor-id="nlcd-2021-total-canopy-cover"><span class="header-section-number">2.3.1</span> NLCD 2021 Total Canopy Cover</h4>
</section>
<section id="landfire" class="level4" data-number="2.3.2">
<h4 data-number="2.3.2" class="anchored" data-anchor-id="landfire"><span class="header-section-number">2.3.2</span> Landfire</h4>
</section>
</section>
<section id="soil-hydrology" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="soil-hydrology"><span class="header-section-number">2.4</span> Soil Hydrology</h3>
<p>AZ_Soil_Hydric_Group data layer</p>
<p><strong>Classification Schema</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 52%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Class</th>
<th style="text-align: center;">Count (pixels)</th>
<th style="text-align: center;">Text</th>
<th style="text-align: center;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">A</td>
<td style="text-align: center;">62559472</td>
<td style="text-align: center;">Group A soils consist of deep, well drained sands or gravelly sands with high infiltration and low runoff rates.</td>
<td style="text-align: center;">10</td>
</tr>
<tr class="even">
<td style="text-align: center;">B</td>
<td style="text-align: center;">76665198</td>
<td style="text-align: center;">Group B soils consist of deep well drained soils with a moderately fine to moderately coarse texture and a moderate rate of infiltration and runoff.</td>
<td style="text-align: center;">8</td>
</tr>
<tr class="odd">
<td style="text-align: center;">C</td>
<td style="text-align: center;">88491710</td>
<td style="text-align: center;">Group C consists of soils with a layer that impedes the downward movement of water or fine textured soils and a slow rate of infiltration.</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="even">
<td style="text-align: center;">D</td>
<td style="text-align: center;">155095790</td>
<td style="text-align: center;">Group D consists of soils with a very slow infiltration rate and high runoff potential. This group is composed of clays that have a high shrink-swell potential, soils with a high water table, soils that have a clay pan or clay layer at or near the surface, and soils that are shallow over nearly impervious material.</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="odd">
<td style="text-align: center;">A/D</td>
<td style="text-align: center;">43192</td>
<td style="text-align: center;">Group A/D soils naturally have a very slow infiltration rate due to a high water table but will have high infiltration and low runoff rates if drained.</td>
<td style="text-align: center;">7</td>
</tr>
<tr class="even">
<td style="text-align: center;">B/D</td>
<td style="text-align: center;">18456</td>
<td style="text-align: center;">Group B/D soils naturally have a very slow infiltration rate due to a high water table but will have a moderate rate of infiltration and runoff if drained.</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="odd">
<td style="text-align: center;">C/D</td>
<td style="text-align: center;">217771</td>
<td style="text-align: center;">Group C/D soils naturally have a very slow infiltration rate due to a high water table but will have a slow rate of infiltration if drained.</td>
<td style="text-align: center;">3</td>
</tr>
</tbody>
</table>
<p><em>Transformed dataset</em> Transformed_AZ_Soil_Hydric_Group</p>
</section>
<section id="depth-to-bedrock" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="depth-to-bedrock"><span class="header-section-number">2.5</span> Depth to Bedrock</h3>
<p><strong>There are 2 data layers which represent depth to bedrock and it is not clear which data layer is prefered!</strong></p>
<ul>
<li>AZ_BedrockDepth_cm.tif
<ul>
<li>218 m resolution</li>
<li>UTM 12N, NAVD88 depth (m) possitive down</li>
<li>0 – 108,273 cm</li>
</ul></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/Depth_to_Bedrock/AZ_BedrockDepth_cm.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="AZ_BedrockDepth_cm.tif with histogram."><img src="images/Depth_to_Bedrock/AZ_BedrockDepth_cm.png" class="img-fluid figure-img" alt="AZ_BedrockDepth_cm.tif with histogram."></a></p>
<figcaption>AZ_BedrockDepth_cm.tif with histogram.</figcaption>
</figure>
</div>
<ul>
<li>Depth to Bedrock WTA
<ul>
<li>Classified</li>
<li>30 m resolution</li>
<li>UTM 12N, NAVD88 height (m) possitive up
<ul>
<li>vertical datum is incorrect. Should be depth (m) possitive down</li>
</ul></li>
<li>0 – 269 cm</li>
<li>Extremely skewed distribution clustering arround 200 cm</li>
</ul></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/Depth_to_Bedrock/Depth_to_Bedrock_WTA.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Depth to Bedrock WTA, DEP2BEDRS_WTA layer with histogram"><img src="images/Depth_to_Bedrock/Depth_to_Bedrock_WTA.png" class="img-fluid figure-img" alt="Depth to Bedrock WTA, DEP2BEDRS_WTA layer with histogram"></a></p>
<figcaption>Depth to Bedrock WTA, DEP2BEDRS_WTA layer with histogram</figcaption>
</figure>
</div>
<section id="soil-vs.-subsurface-geology-weighting-layers" class="level4" data-number="2.5.1">
<h4 data-number="2.5.1" class="anchored" data-anchor-id="soil-vs.-subsurface-geology-weighting-layers"><span class="header-section-number">2.5.1</span> Soil vs.&nbsp;Subsurface Geology Weighting Layers</h4>
<p>To quantify the differental importance of soils vs.&nbsp;subsurface geology layers for determining suitability two related data layers had to be calculated.</p>
<p>The logic assumes that there are two uniform subsurface layers, soil, and subsurface geology (i.e.&nbsp;geology). However, the weighted importance of these layers is not uniform across space. Where the bedrock is close to the surface, we assume that the soil is the most important layer for ground water storage. Inversely, when the bedrock is extremely deep, we assume that the geology is the more important layer. Our soil layer is measured at a depth of 200cm (2m), and we assume a uniform soil depth across the state. Therefore, the depth to bedrock was divided by 200 to get a depth to bedrock (dtb) in soil units. The first “soil depth” was ascribed to the soil layer, and varies from 0 to 1, while the remaining “soil depth” were attibuted to the geology layer, with a range from 0 to 541. Ergo, where the bedrock is deepest, the geology layer is 541 time more influential than the soils layer.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/Depth_to_Bedrock/Notes.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Simple diagram of logic underlying the soil vs.&nbsp;subsurface geology weighting layers."><img src="images/Depth_to_Bedrock/Notes.jpg" class="img-fluid figure-img" alt="Simple diagram of logic underlying the soil vs.&nbsp;subsurface geology weighting layers."></a></p>
<figcaption>Simple diagram of logic underlying the soil vs.&nbsp;subsurface geology weighting layers.</figcaption>
</figure>
</div>
<p>These layers were created in a custom R script using the following raster math, with their resulting outputs.</p>
<section id="soils" class="level5" data-number="2.5.1.1">
<h5 data-number="2.5.1.1" class="anchored" data-anchor-id="soils"><span class="header-section-number">2.5.1.1</span> Soils</h5>
<div class="sourceCode" id="cb1"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="in"># Where depth to bedrock (dtb) = 0cm, soil multiplier = 0 (no soil)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="in"># Where depth to dtb &gt;= 200cm, soil multiplier = 1 (Full depth of soil)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="in"># Intermediate depths = linear</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="in">soilMultiplier = masked</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="in">soilMultiplier[soilMultiplier &gt; 200] = 200  # Fix upper limit of soil depth = 200 cm</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="in">soilMultiplier = soilMultiplier/200</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/Depth_to_Bedrock/SoilsMultiplier.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Soils multipler layer."><img src="images/Depth_to_Bedrock/SoilsMultiplier.png" class="img-fluid figure-img" alt="Soils multipler layer."></a></p>
<figcaption>Soils multipler layer.</figcaption>
</figure>
</div>
</section>
<section id="geology" class="level5" data-number="2.5.1.2">
<h5 data-number="2.5.1.2" class="anchored" data-anchor-id="geology"><span class="header-section-number">2.5.1.2</span> Geology</h5>
<div class="sourceCode" id="cb2"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="in"># Where dtb &lt; 200cm, geology multiplier = 0 (soil only)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="in"># Where dtb &gt;= 200cm, geology multiplier = dtb/200 (in units of relative soil depth)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="in">geologyMultiplier = masked</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="in">geologyMultiplier[geologyMultiplier &lt; 200] = 0</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="in">geologyMultiplier = geologyMultiplier/200</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/Depth_to_Bedrock/GeologyMultiplier.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="Geology multiplier layer."><img src="images/Depth_to_Bedrock/GeologyMultiplier.png" class="img-fluid figure-img" alt="Geology multiplier layer."></a></p>
<figcaption>Geology multiplier layer.</figcaption>
</figure>
</div>
</section>
</section>
</section>
<section id="other-data-layers-for-consideration" class="level3" data-number="2.6">
<h3 data-number="2.6" class="anchored" data-anchor-id="other-data-layers-for-consideration"><span class="header-section-number">2.6</span> Other Data Layers for Consideration</h3>
<section id="global-hydrologic-curve-numbergcn250" class="level4" data-number="2.6.1">
<h4 data-number="2.6.1" class="anchored" data-anchor-id="global-hydrologic-curve-numbergcn250"><span class="header-section-number">2.6.1</span> Global Hydrologic Curve Number(GCN250)</h4>
<p>https://gee-community-catalog.org/projects/gcn250/?h=hydrologic</p>
<blockquote class="blockquote">
<p>The GCN250 is a globally consistent, gridded dataset defining CNs at the <strong>250 m spatial resolution</strong> from new global land cover (300 m) and soils data (250 m). GCN250 <strong>represents runoff</strong> for a combination of the European space agency global land cover dataset for 2015 (ESA CCI-LC) resampled to 250 m and geo-registered with the hydrologic soil group global data product (HYSOGs250m) released in 2018. The <strong>potential application</strong> of this data includes <strong>hydrologic design</strong>, land management applications, flood risk assessment, and <strong>groundwater recharge modeling</strong>. The CN values vary depending on antecedent runoff conditions (ARC), which is affected by the rainfall intensity and duration, total rainfall, soil moisture conditions, cover density, stage of growth, and temperature[.] <em>emphasis mine</em></p>
</blockquote>
</section>
<section id="soil-properties-800m" class="level4" data-number="2.6.2">
<h4 data-number="2.6.2" class="anchored" data-anchor-id="soil-properties-800m"><span class="header-section-number">2.6.2</span> Soil Properties 800m</h4>
<p>https://gee-community-catalog.org/projects/soilprop/?h=</p>
<blockquote class="blockquote">
<p>The data shown here were obtained by aggregating current USDA-NCSS soil survey data (SSURGO back-filled with STATSGO where SSURGO is not available) within <strong>800m² grid cells</strong>. This data aggregation technique results in maps that may not match the original data at any given point, and is <strong>intended to depict regional trends in soil properties at the statewide scale</strong>. <em>emphasis mine</em></p>
</blockquote>
<ul>
<li>Pros:
<ul>
<li>Lots of relevant data layers, such as:
<ul>
<li>Avail. Water Holding Capacity</li>
<li>Drainage Class</li>
<li>Sat. Hyd. Conductivity</li>
<li>Depth to Restrictive Layer</li>
<li>Hydrologic Group</li>
<li>Soil Depth</li>
<li>etc.</li>
</ul></li>
</ul></li>
<li>Cons:
<ul>
<li>800m resolution</li>
<li>Large data gaps (layer dependent)</li>
</ul></li>
</ul>
<section id="alternative-layers" class="level5" data-number="2.6.2.1">
<h5 data-number="2.6.2.1" class="anchored" data-anchor-id="alternative-layers"><span class="header-section-number">2.6.2.1</span> Alternative layers</h5>
<p><a href="https://gee-community-catalog.org/projects/gnatsgo/">gNATSGO (gridded National Soil Survey Geographic Database)</a></p>
<ul>
<li>Pros:
<ul>
<li>Authoritative</li>
<li>Source layer for value added products (including Soil Properties 800m)</li>
<li>10m resolution</li>
</ul></li>
<li>Cons:
<ul>
<li>Large data gaps across AZ</li>
<li>10m resolution</li>
</ul></li>
</ul>
<p><a href="https://gee-community-catalog.org/projects/polaris/">Polaris 30m Probabilistic Soil Properties US</a></p>
<ul>
<li>Pros:
<ul>
<li>Continuous data availability (no gaps)</li>
<li>30m resolution</li>
</ul></li>
<li>Cons:
<ul>
<li>Fewer data layers</li>
<li>Probabalistic model (increased uncertainty)</li>
</ul></li>
</ul>
</section>
</section>
</section>
</section>
<section id="sec-conclusions" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="sec-conclusions"><span class="header-section-number">3</span> Conclusion</h2>
</section>
<section id="references" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="references">References</h2>
</section>
     </main>
<!-- /main column -->  <script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>  </div> <!-- /content -->  <script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script> 
  
</body></html>