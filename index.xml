<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving
and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">

<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="1.2" article-type="other">

<front>


<article-meta>


<title-group>
<article-title>Arizona Aquifer Recharge Suitability
Analysis</article-title>
</title-group>

<contrib-group>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">0009-0006-0181-3099</contrib-id>
<name>
<surname>Zalesky</surname>
<given-names>Travis</given-names>
</name>
<string-name>Travis Zalesky</string-name>

<email>travisz@arizona.edu</email>
<role>Author</role>
<role>GIST Software and Applications</role>
<role>Cartography</role>
<role>Suitability Analysis</role>
<xref ref-type="aff" rid="aff-1">a</xref>
<xref ref-type="corresp" rid="cor-1">&#x002A;</xref>
</contrib>
</contrib-group>
<aff id="aff-1">
<institution-wrap>
<institution>University of Arizona</institution>
</institution-wrap>







</aff>
<author-notes>
<corresp id="cor-1">travisz@arizona.edu</corresp>
</author-notes>









<history></history>


<abstract>
<p>Aquifer recharge can be either passive or active, and is implemented
in a variety of ways. This analysis seeks to identify regions across AZ
which are broadly suitable for aquifer recharge projects as a general
template for more focused analysis.</p>
</abstract>
<kwd-group kwd-group-type="author">
<kwd>Arizona Tri University Recharge (ATUR)</kwd>
<kwd>water table</kwd>
<kwd>ground water</kwd>
</kwd-group>




</article-meta>

</front>

<body>
<sec id="introduction">
  <title>1 Introduction</title>
</sec>
<sec id="sec-data-methods">
  <title>2 Data &amp; Methods</title>
  <p><bold>These methods and data layers are preliminary and subject to
  change</bold></p>
  <sec id="elevation">
    <title>2.1 Elevation</title>
    <sec id="dem">
      <title>2.1.1 DEM</title>
      <p>Elevation and elevation derivatives from 30-m NASA SRTM. USGS
      3-DEM (10m) product not suitable for full study area analysis due
      to (1) the large area of missing data in Mexico, and (2), the
      excessively high spatial resolution (massively increasing
      computational requirements).</p>
      <p>SRTM elevation sinks filled prior to calculating slope and
      aspect.</p>
      <p><bold>Should elevation be directly used in the suitability
      analysis?</bold></p>
    </sec>
    <sec id="slope">
      <title>2.1.2 Slope</title>
      <p>Slope derived from hydrologically conditioned (filled) 30-m
      SRTM layer using quadratic surface function and a fixed 30-m
      neighborhood. Slope measured in °.</p>
      <disp-quote>
        <p>Higher slopes are less suitable because thinning is both more
        expensive and more precipitation will end up as runoff.</p>
      </disp-quote>
      <p>Slope classified from 1-10 using a <bold>continuous
      function</bold> in ArcPro Suitability Mapper.</p>
      <table-wrap>
        <table>
          <colgroup>
            <col width="38%" />
            <col width="62%" />
          </colgroup>
          <thead>
            <tr>
              <th align="center">Parameter</th>
              <th align="center">Setting</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="center">Function</td>
              <td align="center"><ext-link ext-link-type="uri" xlink:href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-analyst/the-transformation-functions-available-for-rescale-by-function.htm#ESRI_SECTION1_6C2FDA23D8094B8F99DBF3DF5E176B1D">MSSSmall</ext-link></td>
            </tr>
            <tr>
              <td align="center">Mean multiplier</td>
              <td align="center">1</td>
            </tr>
            <tr>
              <td align="center">Sddv multiplier</td>
              <td align="center">2</td>
            </tr>
            <tr>
              <td align="center">Lower threshold</td>
              <td align="center">0</td>
            </tr>
            <tr>
              <td align="center">Value below threshold</td>
              <td align="center">0</td>
            </tr>
            <tr>
              <td align="center">Upper threshold</td>
              <td align="center">90</td>
            </tr>
            <tr>
              <td align="center">Value above threshold</td>
              <td align="center">0</td>
            </tr>
            <tr>
              <td align="center">Invert function</td>
              <td align="center">FALSE</td>
            </tr>
            <tr>
              <td align="center">Save transformed dataset</td>
              <td align="center">TRUE</td>
            </tr>
            <tr>
              <td align="center">Output</td>
              <td align="center">Transformed_SRTM_slope</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
      <fig>
        <caption><p>Slope suitability mapper rescale transformation
        setup.</p></caption>
        <graphic mimetype="image" mime-subtype="png" xlink:href="images/SuitabilityAnalysis_Transformations/Slope.png" />
      </fig>
    </sec>
    <sec id="aspect">
      <title>2.1.3 Aspect</title>
      <p>Aspect calculated as with slope. Aspect reference point at N.
      Pole.</p>
      <disp-quote>
        <p>Aspect has a large impact on solar radiation.</p>
      </disp-quote>
      <disp-quote>
        <p>Closer to 0 or 360 is desired, low suitability scores for
        closeness.</p>
      </disp-quote>
      <p>Aspect classified from 1-10 using a <bold>continuous
      function</bold> in ArcPro Suitability Mapper.</p>
      <table-wrap>
        <table>
          <colgroup>
            <col width="38%" />
            <col width="62%" />
          </colgroup>
          <thead>
            <tr>
              <th align="center">Parameter</th>
              <th align="center">Setting</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="center">Function</td>
              <td align="center"><ext-link ext-link-type="uri" xlink:href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-analyst/the-transformation-functions-available-for-rescale-by-function.htm#ESRI_SECTION1_A7FC2FC126CD4A41974C8D3F5E0F8FD6">Near</ext-link></td>
            </tr>
            <tr>
              <td align="center">Mid Point</td>
              <td align="center">180</td>
            </tr>
            <tr>
              <td align="center">Point spread</td>
              <td align="center">0.0011049638968393428 (default)</td>
            </tr>
            <tr>
              <td align="center">Lower threshold</td>
              <td align="center">-1 (flat)</td>
            </tr>
            <tr>
              <td align="center">Value below threshold</td>
              <td align="center">0</td>
            </tr>
            <tr>
              <td align="center">Upper threshold</td>
              <td align="center">360</td>
            </tr>
            <tr>
              <td align="center">Value above threshold</td>
              <td align="center">0</td>
            </tr>
            <tr>
              <td align="center">Invert function</td>
              <td align="center">TRUE</td>
            </tr>
            <tr>
              <td align="center">Save transformed dataset</td>
              <td align="center">TRUE</td>
            </tr>
            <tr>
              <td align="center">Output</td>
              <td align="center">Transformed_SRTM_aspect</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
      <fig>
        <caption><p>Aspect suitability mapper rescale transformation
        setup.</p></caption>
        <graphic mimetype="image" mime-subtype="png" xlink:href="images/SuitabilityAnalysis_Transformations/Aspect.png" />
      </fig>
    </sec>
  </sec>
  <sec id="precipitation">
    <title>2.2 Precipitation</title>
    <p>PRISM normals, 800m resolution. Annual precipitation.</p>
    <disp-quote>
      <p>Mean annual precipitation must be higher than 500mm 1990 -
      2020</p>
    </disp-quote>
    <p>Precipitation classified from 1-10 using a <bold>continuous
    function</bold> in ArcPro Suitability Mapper.</p>
    <p>NOTE: The logistic growth function may also be a good choice for
    this dataset. See
    <ext-link ext-link-type="uri" xlink:href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-analyst/the-transformation-functions-available-for-rescale-by-function.htm#ESRI_SECTION1_76ED0A2D02A24C95B98B8A691603F2F4">Logistic
    Growth function</ext-link></p>
    <table-wrap>
      <table>
        <colgroup>
          <col width="38%" />
          <col width="62%" />
        </colgroup>
        <thead>
          <tr>
            <th align="center">Parameter</th>
            <th align="center">Setting</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="center">Function</td>
            <td align="center"><ext-link ext-link-type="uri" xlink:href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-analyst/the-transformation-functions-available-for-rescale-by-function.htm#ESRI_SECTION1_B83C9047549542DE995823E6030A29F3">MSLarge</ext-link></td>
          </tr>
          <tr>
            <td align="center">Mean multiplier</td>
            <td align="center">1.68 (approximates 500mm at
            x-intercept)</td>
          </tr>
          <tr>
            <td align="center">Sddv multiplier</td>
            <td align="center">1</td>
          </tr>
          <tr>
            <td align="center">Lower threshold</td>
            <td align="center">67.33789825439453 (default, minimum)</td>
          </tr>
          <tr>
            <td align="center">Value below threshold</td>
            <td align="center">0</td>
          </tr>
          <tr>
            <td align="center">Upper threshold</td>
            <td align="center">1214.5689697265625 (default,
            maximum)</td>
          </tr>
          <tr>
            <td align="center">Value above threshold</td>
            <td align="center">0</td>
          </tr>
          <tr>
            <td align="center">Invert function</td>
            <td align="center">FALSE</td>
          </tr>
          <tr>
            <td align="center">Save transformed dataset</td>
            <td align="center">TRUE</td>
          </tr>
          <tr>
            <td align="center">Output</td>
            <td align="center">Transformed_PRISM_ppt_30yrnormal_800m</td>
          </tr>
        </tbody>
      </table>
    </table-wrap>
    <fig>
      <caption><p>Aspect suitability mapper rescale transformation
      setup.</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="images/SuitabilityAnalysis_Transformations/Precip_PRISM.png" />
    </fig>
  </sec>
  <sec id="vegetation-characteristics">
    <title>2.3 Vegetation Characteristics</title>
    <sec id="nlcd-2021-total-canopy-cover">
      <title>2.3.1 NLCD 2021 Total Canopy Cover</title>
    </sec>
    <sec id="landfire">
      <title>2.3.2 Landfire</title>
    </sec>
  </sec>
  <sec id="soil-hydrology">
    <title>2.4 Soil Hydrology</title>
    <p>AZ_Soil_Hydric_Group data layer</p>
    <p><bold>Classification Schema</bold></p>
    <table-wrap>
      <table>
        <colgroup>
          <col width="16%" />
          <col width="16%" />
          <col width="52%" />
          <col width="16%" />
        </colgroup>
        <thead>
          <tr>
            <th align="center">Class</th>
            <th align="center">Count (pixels)</th>
            <th align="center">Text</th>
            <th align="center">Value</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="center">A</td>
            <td align="center">62559472</td>
            <td align="center">Group A soils consist of deep, well
            drained sands or gravelly sands with high infiltration and
            low runoff rates.</td>
            <td align="center">10</td>
          </tr>
          <tr>
            <td align="center">B</td>
            <td align="center">76665198</td>
            <td align="center">Group B soils consist of deep well
            drained soils with a moderately fine to moderately coarse
            texture and a moderate rate of infiltration and runoff.</td>
            <td align="center">8</td>
          </tr>
          <tr>
            <td align="center">C</td>
            <td align="center">88491710</td>
            <td align="center">Group C consists of soils with a layer
            that impedes the downward movement of water or fine textured
            soils and a slow rate of infiltration.</td>
            <td align="center">5</td>
          </tr>
          <tr>
            <td align="center">D</td>
            <td align="center">155095790</td>
            <td align="center">Group D consists of soils with a very
            slow infiltration rate and high runoff potential. This group
            is composed of clays that have a high shrink-swell
            potential, soils with a high water table, soils that have a
            clay pan or clay layer at or near the surface, and soils
            that are shallow over nearly impervious material.</td>
            <td align="center">2</td>
          </tr>
          <tr>
            <td align="center">A/D</td>
            <td align="center">43192</td>
            <td align="center">Group A/D soils naturally have a very
            slow infiltration rate due to a high water table but will
            have high infiltration and low runoff rates if drained.</td>
            <td align="center">7</td>
          </tr>
          <tr>
            <td align="center">B/D</td>
            <td align="center">18456</td>
            <td align="center">Group B/D soils naturally have a very
            slow infiltration rate due to a high water table but will
            have a moderate rate of infiltration and runoff if
            drained.</td>
            <td align="center">6</td>
          </tr>
          <tr>
            <td align="center">C/D</td>
            <td align="center">217771</td>
            <td align="center">Group C/D soils naturally have a very
            slow infiltration rate due to a high water table but will
            have a slow rate of infiltration if drained.</td>
            <td align="center">3</td>
          </tr>
        </tbody>
      </table>
    </table-wrap>
    <p><italic>Transformed dataset</italic>
    Transformed_AZ_Soil_Hydric_Group</p>
  </sec>
  <sec id="depth-to-bedrock">
    <title>2.5 Depth to Bedrock</title>
    <p><bold>There are 2 data layers which represent depth to bedrock
    and it is not clear which data layer is preferred!</bold></p>
    <list list-type="bullet">
      <list-item>
        <p>AZ_BedrockDepth_cm.tif</p>
        <list list-type="bullet">
          <list-item>
            <p>218 m resolution</p>
          </list-item>
          <list-item>
            <p>UTM 12N, NAVD88 depth (m) positive down</p>
          </list-item>
          <list-item>
            <p>0 – 108,273 cm</p>
          </list-item>
        </list>
      </list-item>
    </list>
    <fig>
      <caption><p>AZ_BedrockDepth_cm.tif with histogram.</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="images/Depth_to_Bedrock/AZ_BedrockDepth_cm.png" />
    </fig>
    <list list-type="bullet">
      <list-item>
        <p>Depth to Bedrock WTA</p>
        <list list-type="bullet">
          <list-item>
            <p>Classified</p>
          </list-item>
          <list-item>
            <p>30 m resolution</p>
          </list-item>
          <list-item>
            <p>UTM 12N, NAVD88 height (m) positive up</p>
            <list list-type="bullet">
              <list-item>
                <p>vertical datum is incorrect. Should be depth (m)
                positive down</p>
              </list-item>
            </list>
          </list-item>
          <list-item>
            <p>0 – 269 cm</p>
          </list-item>
          <list-item>
            <p>Extremely skewed distribution clustering around 200
            cm</p>
          </list-item>
        </list>
      </list-item>
    </list>
    <fig>
      <caption><p>Depth to Bedrock WTA, DEP2BEDRS_WTA layer with
      histogram</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="images/Depth_to_Bedrock/Depth_to_Bedrock_WTA.png" />
    </fig>
    <sec id="soil-vs.-subsurface-geology-weighting-layers">
      <title>2.5.1 Soil vs. Subsurface Geology Weighting Layers</title>
      <p>To quantify the differential importance of soils vs. subsurface
      geology layers for determining suitability two related data layers
      had to be calculated.</p>
      <p>The logic assumes that there are two uniform subsurface layers,
      soil, and subsurface geology (i.e. geology). However, the weighted
      importance of these layers is not uniform across space. Where the
      bedrock is close to the surface, we assume that the soil is the
      most important layer for ground water storage. Inversely, when the
      bedrock is extremely deep, we assume that the geology is the more
      important layer. Our soil layer is measured at a depth of 200cm
      (2m), and we assume a uniform soil depth across the state.
      Therefore, the depth to bedrock was divided by 200 to get a depth
      to bedrock (dtb) in soil units. The first “soil depth” was
      ascribed to the soil layer, and varies from 0 to 1, while the
      remaining “soil depth” were attributed to the geology layer, with
      a range from 0 to 541. Ergo, where the bedrock is deepest, the
      geology layer is 541 time more influential than the soils
      layer.</p>
      <fig>
        <caption><p>Simple diagram of logic underlying the soil
        vs. subsurface geology weighting layers.</p></caption>
        <graphic mimetype="image" mime-subtype="jpeg" xlink:href="images/Depth_to_Bedrock/Notes.jpg" />
      </fig>
      <p>These layers were created in a custom R script using the
      following raster math, with their resulting outputs.</p>
      <sec id="soils">
        <title>2.5.1.1 Soils</title>
        <code language="markdown">```{r}
# Where depth to bedrock (dtb) = 0cm, soil multiplier = 0 (no soil)
# Where depth to dtb &gt;= 200cm, soil multiplier = 1 (Full depth of soil)
# Intermediate depths = linear
soilMultiplier = masked
soilMultiplier[soilMultiplier &gt; 200] = 200  # Fix upper limit of soil depth = 200 cm
soilMultiplier = soilMultiplier/200
```</code>
        <fig>
          <caption><p>Soils multiplier layer.</p></caption>
          <graphic mimetype="image" mime-subtype="png" xlink:href="images/Depth_to_Bedrock/SoilsMultiplier.png" />
        </fig>
      </sec>
      <sec id="geology">
        <title>2.5.1.2 Geology</title>
        <code language="markdown">```{r}
# Where dtb &lt; 200cm, geology multiplier = 0 (soil only)
# Where dtb &gt;= 200cm, geology multiplier = dtb/200 (in units of relative soil depth)
geologyMultiplier = masked
geologyMultiplier[geologyMultiplier &lt; 200] = 0
geologyMultiplier = geologyMultiplier/200
```</code>
        <fig>
          <caption><p>Geology multiplier layer.</p></caption>
          <graphic mimetype="image" mime-subtype="png" xlink:href="images/Depth_to_Bedrock/GeologyMultiplier.png" />
        </fig>
      </sec>
    </sec>
  </sec>
  <sec id="other-data-layers-for-consideration">
    <title>2.6 Other Data Layers for Consideration</title>
    <sec id="global-hydrologic-curve-numbergcn250">
      <title>2.6.1 Global Hydrologic Curve Number(GCN250)</title>
      <p>https://gee-community-catalog.org/projects/gcn250/?h=hydrologic</p>
      <disp-quote>
        <p>The GCN250 is a globally consistent, gridded dataset defining
        CNs at the <bold>250 m spatial resolution</bold> from new global
        land cover (300 m) and soils data (250 m). GCN250
        <bold>represents runoff</bold> for a combination of the European
        space agency global land cover dataset for 2015 (ESA CCI-LC)
        resampled to 250 m and geo-registered with the hydrologic soil
        group global data product (HYSOGs250m) released in 2018. The
        <bold>potential application</bold> of this data includes
        <bold>hydrologic design</bold>, land management applications,
        flood risk assessment, and <bold>groundwater recharge
        modeling</bold>. The CN values vary depending on antecedent
        runoff conditions (ARC), which is affected by the rainfall
        intensity and duration, total rainfall, soil moisture
        conditions, cover density, stage of growth, and temperature[.]
        <italic>emphasis mine</italic></p>
      </disp-quote>
    </sec>
    <sec id="soil-properties-800m">
      <title>2.6.2 Soil Properties 800m</title>
      <p>https://gee-community-catalog.org/projects/soilprop/?h=</p>
      <disp-quote>
        <p>The data shown here were obtained by aggregating current
        USDA-NCSS soil survey data (SSURGO back-filled with STATSGO
        where SSURGO is not available) within <bold>800m² grid
        cells</bold>. This data aggregation technique results in maps
        that may not match the original data at any given point, and is
        <bold>intended to depict regional trends in soil properties at
        the statewide scale</bold>. <italic>emphasis mine</italic></p>
      </disp-quote>
      <list list-type="bullet">
        <list-item>
          <p>Pros:</p>
          <list list-type="bullet">
            <list-item>
              <p>Lots of relevant data layers, such as:</p>
              <list list-type="bullet">
                <list-item>
                  <p>Avail. Water Holding Capacity</p>
                </list-item>
                <list-item>
                  <p>Drainage Class</p>
                </list-item>
                <list-item>
                  <p>Sat. Hyd. Conductivity</p>
                </list-item>
                <list-item>
                  <p>Depth to Restrictive Layer</p>
                </list-item>
                <list-item>
                  <p>Hydrologic Group</p>
                </list-item>
                <list-item>
                  <p>Soil Depth</p>
                </list-item>
                <list-item>
                  <p>etc.</p>
                </list-item>
              </list>
            </list-item>
          </list>
        </list-item>
        <list-item>
          <p>Cons:</p>
          <list list-type="bullet">
            <list-item>
              <p>800m resolution</p>
            </list-item>
            <list-item>
              <p>Large data gaps (layer dependent)</p>
            </list-item>
          </list>
        </list-item>
      </list>
      <sec id="alternative-layers">
        <title>2.6.2.1 Alternative layers</title>
        <p><ext-link ext-link-type="uri" xlink:href="https://gee-community-catalog.org/projects/gnatsgo/">gNATSGO
        (gridded National Soil Survey Geographic
        Database)</ext-link></p>
        <list list-type="bullet">
          <list-item>
            <p>Pros:</p>
            <list list-type="bullet">
              <list-item>
                <p>Authoritative</p>
              </list-item>
              <list-item>
                <p>Source layer for value added products (including Soil
                Properties 800m)</p>
              </list-item>
              <list-item>
                <p>10m resolution</p>
              </list-item>
            </list>
          </list-item>
          <list-item>
            <p>Cons:</p>
            <list list-type="bullet">
              <list-item>
                <p>Large data gaps across AZ</p>
              </list-item>
              <list-item>
                <p>10m resolution</p>
              </list-item>
            </list>
          </list-item>
        </list>
        <p><ext-link ext-link-type="uri" xlink:href="https://gee-community-catalog.org/projects/polaris/">Polaris
        30m Probabilistic Soil Properties US</ext-link></p>
        <list list-type="bullet">
          <list-item>
            <p>Pros:</p>
            <list list-type="bullet">
              <list-item>
                <p>Continuous data availability (no gaps)</p>
              </list-item>
              <list-item>
                <p>30m resolution</p>
              </list-item>
            </list>
          </list-item>
          <list-item>
            <p>Cons:</p>
            <list list-type="bullet">
              <list-item>
                <p>Fewer data layers</p>
              </list-item>
              <list-item>
                <p>Probabilistic model (increased uncertainty)</p>
              </list-item>
            </list>
          </list-item>
        </list>
      </sec>
    </sec>
    <sec id="leaf-area-index-lai">
      <title>2.6.3 Leaf Area Index (LAI)</title>
      <p>Leaf Area Index (LAI) can be calculated from Landsat data (30 m
      resolution), as a proxy of land cover. LAI is a unitless index
      value which is calculated as a function of the Enhanced Vegetation
      Index (ENVI) and typically ranges from 0 to 3.5 (<italic>citation
      needed</italic>). LAI can be calculated efficiently over a large
      spatial scale in Google Earth Engine (GEE) using the Javascript
      API, however LAI will vary seasonally, with updated Landsat data
      available every 8-days. Additionally, due to our large study area,
      as well as the logistics of Landsat orbital paths, it takes 6 days
      to photograph the entire study area. Therefore, any LAI analysis
      on this scale will necessarily be a mosaic image, over roughly a
      week. For these reasons, a single LAI image should be viewed with
      some skepticism, and a seasonal mean or median LAI mosaic image
      may be more desireable as a proxy for land cover.</p>
      <p>Code is available for calculating LAI from Landsat 8/9 imagery
      in my personal GEE scripts folder, which could be easily modified
      for purpose. Due to the large number of Landsat images involved
      the study period must be narrowed prior to analysis (i.e. July
      LAI, Winter LAI, etc.). Additional post-processing of LAI images
      may be required outside of GEE.</p>
      <sec id="google-earth-engine-lai-javascript-code">
        <title>2.6.3.1 Google Earth Engine LAI Javascript Code</title>
        <preformat>var studyArea = ee.FeatureCollection(&quot;projects/ee-travisz09/assets/ATUR/WBDHU8_OuterBoundary_Project&quot;),
    landsat9 = ee.ImageCollection(&quot;LANDSAT/LC09/C02/T1_TOA&quot;);

// Map setup
Map.centerObject(studyArea, 6);
Map.addLayer(studyArea, {}, 'Study Area', false);

// Paint study area outline
var empty = ee.Image().byte();  // An empty layer to paint on
var studyAreaOutline = empty.paint(studyArea, 'black', 2);
Map.addLayer(studyAreaOutline, {}, 'Study Area (outline)');

// Study period
var startDate = ee.Date('2023-01-01');
var endDate = ee.Date('2024-01-01');  // Exclusive end date
var timeDif = endDate.difference(startDate, 'day');
// var interval = 8;  // days
// print(timeDif);

// Landsat 8/9
var cloudFilter = 10  // 10% max cloud cover
var landsat = ee.ImageCollection('LANDSAT/LC08/C02/T1_L2')
  .merge(ee.ImageCollection('LANDSAT/LC09/C02/T1_L2'))  // Combine Lst-9 and Lst-8
  .filterDate(startDate, endDate)
  .filterBounds(studyArea)
  .sort('system:time_start')  // Sort by date
  .filter(ee.Filter.lt('CLOUD_COVER', cloudFilter));
  
// Lst scaling factor function
var scaleLst = function(col) {
  // Map over images in collection
  var scaled = col.map(function(img) {
    var opticalBands = img.select('SR_B.').multiply(0.0000275).add(-0.2);
    var thermalBands = img.select('ST_B.*').multiply(0.00341802).add(149.0);
    
    return img.addBands(opticalBands, null, true)  // Overwrite unscaled bands
      .addBands(thermalBands, null, true);
  });
  
  return scaled;
};

// print(landsat.first());  // Check the Lst data before scaling
landsat = scaleLst(landsat);  // Apply scaling factor
// print(landsat.first());  // Check Lst data after scaling

// NDVI, EVI, LAI, index function
var calcIndices = function(col) {
  var indices = col.map(function(img) {
    var ndvi = img.normalizedDifference(['SR_B5', 'SR_B4'])
      .rename('ndvi');
    var evi = img.expression(
      '2.5 * ((nir - red) / (nir + 6 * red - 7.5 * blue + 1))',
      {
        'nir': img.select('SR_B5'),
        'red': img.select('SR_B4'),
        'blue': img.select('SR_B2')
      }).rename('evi');
    var lai = evi.expression(
      '3.618 * evi - 0.118', 
      {
        'evi': evi.select('evi')
      }).rename('lai');
      
    return img.addBands(ndvi)
      .addBands(evi)
      .addBands(lai);
  });
  
  return indices;
};

// Apply indices
landsat = calcIndices(landsat);
// print(landsat.first());  // sanity check

// Isolate lai bands
var lai = landsat.map(function(img) {
  return img.select('lai');
});

Map.addLayer(lai.limit(20), {
  min: 0,
  max: 3.5,
  palette: ['red', 'white', 'green']
}, 'LAI');
print(lai);</preformat>
      </sec>
    </sec>
  </sec>
</sec>
<sec id="sec-conclusions">
  <title>3 Conclusion</title>
</sec>
<sec id="references">
  <title>References</title>
</sec>
</body>

<back>
</back>

<sub-article article-type="notebook" id="nb-8-nb-article">
<front-stub>
<title-group>
<article-title>Arizona Aquifer Recharge Suitability
Analysis</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">0009-0006-0181-3099</contrib-id>
<name>
<surname>Zalesky</surname>
<given-names>Travis</given-names>
</name>
<string-name>Travis Zalesky</string-name>

<email>travisz@arizona.edu</email>
<role>Author</role>
<role>GIST Software and Applications</role>
<role>Cartography</role>
<role>Suitability Analysis</role>
<xref ref-type="aff" rid="aff-1-nb-article">a</xref>
<xref ref-type="corresp" rid="cor-1-nb-article">&#x002A;</xref>
</contrib>
</contrib-group>
<aff id="aff-1-nb-article">
<institution-wrap>
<institution>University of Arizona</institution>
</institution-wrap>







</aff>
<author-notes>
<corresp id="cor-1-nb-article">travisz@arizona.edu</corresp>
</author-notes>
<abstract>
<p>Aquifer recharge can be either passive or active, and is implemented
in a variety of ways. This analysis seeks to identify regions across AZ
which are broadly suitable for aquifer recharge projects as a general
template for more focused analysis.</p>
</abstract>
</front-stub>

<body>
<sec id="introduction-nb-article">
  <title>1 Introduction</title>
</sec>
<sec id="sec-data-methods-nb-article">
  <title>2 Data &amp; Methods</title>
  <p><bold>These methods and data layers are preliminary and subject to
  change</bold></p>
  <sec id="elevation-nb-article">
    <title>2.1 Elevation</title>
    <sec id="dem-nb-article">
      <title>2.1.1 DEM</title>
      <p>Elevation and elevation derivatives from 30-m NASA SRTM. USGS
      3-DEM (10m) product not suitable for full study area analysis due
      to (1) the large area of missing data in Mexico, and (2), the
      excessively high spatial resolution (massively increasing
      computational requirements).</p>
      <p>SRTM elevation sinks filled prior to calculating slope and
      aspect.</p>
      <p><bold>Should elevation be directly used in the suitability
      analysis?</bold></p>
    </sec>
    <sec id="slope-nb-article">
      <title>2.1.2 Slope</title>
      <p>Slope derived from hydrologically conditioned (filled) 30-m
      SRTM layer using quadratic surface function and a fixed 30-m
      neighborhood. Slope measured in °.</p>
      <disp-quote>
        <p>Higher slopes are less suitable because thinning is both more
        expensive and more precipitation will end up as runoff.</p>
      </disp-quote>
      <p>Slope classified from 1-10 using a <bold>continuous
      function</bold> in ArcPro Suitability Mapper.</p>
      <table-wrap>
        <table>
          <colgroup>
            <col width="38%" />
            <col width="62%" />
          </colgroup>
          <thead>
            <tr>
              <th align="center">Parameter</th>
              <th align="center">Setting</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="center">Function</td>
              <td align="center"><ext-link ext-link-type="uri" xlink:href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-analyst/the-transformation-functions-available-for-rescale-by-function.htm#ESRI_SECTION1_6C2FDA23D8094B8F99DBF3DF5E176B1D">MSSSmall</ext-link></td>
            </tr>
            <tr>
              <td align="center">Mean multiplier</td>
              <td align="center">1</td>
            </tr>
            <tr>
              <td align="center">Sddv multiplier</td>
              <td align="center">2</td>
            </tr>
            <tr>
              <td align="center">Lower threshold</td>
              <td align="center">0</td>
            </tr>
            <tr>
              <td align="center">Value below threshold</td>
              <td align="center">0</td>
            </tr>
            <tr>
              <td align="center">Upper threshold</td>
              <td align="center">90</td>
            </tr>
            <tr>
              <td align="center">Value above threshold</td>
              <td align="center">0</td>
            </tr>
            <tr>
              <td align="center">Invert function</td>
              <td align="center">FALSE</td>
            </tr>
            <tr>
              <td align="center">Save transformed dataset</td>
              <td align="center">TRUE</td>
            </tr>
            <tr>
              <td align="center">Output</td>
              <td align="center">Transformed_SRTM_slope</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
      <fig>
        <caption><p>Slope suitability mapper rescale transformation
        setup.</p></caption>
        <graphic mimetype="image" mime-subtype="png" xlink:href="images/SuitabilityAnalysis_Transformations/Slope.png" />
      </fig>
    </sec>
    <sec id="aspect-nb-article">
      <title>2.1.3 Aspect</title>
      <p>Aspect calculated as with slope. Aspect reference point at N.
      Pole.</p>
      <disp-quote>
        <p>Aspect has a large impact on solar radiation.</p>
      </disp-quote>
      <disp-quote>
        <p>Closer to 0 or 360 is desired, low suitability scores for
        closeness.</p>
      </disp-quote>
      <p>Aspect classified from 1-10 using a <bold>continuous
      function</bold> in ArcPro Suitability Mapper.</p>
      <table-wrap>
        <table>
          <colgroup>
            <col width="38%" />
            <col width="62%" />
          </colgroup>
          <thead>
            <tr>
              <th align="center">Parameter</th>
              <th align="center">Setting</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="center">Function</td>
              <td align="center"><ext-link ext-link-type="uri" xlink:href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-analyst/the-transformation-functions-available-for-rescale-by-function.htm#ESRI_SECTION1_A7FC2FC126CD4A41974C8D3F5E0F8FD6">Near</ext-link></td>
            </tr>
            <tr>
              <td align="center">Mid Point</td>
              <td align="center">180</td>
            </tr>
            <tr>
              <td align="center">Point spread</td>
              <td align="center">0.0011049638968393428 (default)</td>
            </tr>
            <tr>
              <td align="center">Lower threshold</td>
              <td align="center">-1 (flat)</td>
            </tr>
            <tr>
              <td align="center">Value below threshold</td>
              <td align="center">0</td>
            </tr>
            <tr>
              <td align="center">Upper threshold</td>
              <td align="center">360</td>
            </tr>
            <tr>
              <td align="center">Value above threshold</td>
              <td align="center">0</td>
            </tr>
            <tr>
              <td align="center">Invert function</td>
              <td align="center">TRUE</td>
            </tr>
            <tr>
              <td align="center">Save transformed dataset</td>
              <td align="center">TRUE</td>
            </tr>
            <tr>
              <td align="center">Output</td>
              <td align="center">Transformed_SRTM_aspect</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
      <fig>
        <caption><p>Aspect suitability mapper rescale transformation
        setup.</p></caption>
        <graphic mimetype="image" mime-subtype="png" xlink:href="images/SuitabilityAnalysis_Transformations/Aspect.png" />
      </fig>
    </sec>
  </sec>
  <sec id="precipitation-nb-article">
    <title>2.2 Precipitation</title>
    <p>PRISM normals, 800m resolution. Annual precipitation.</p>
    <disp-quote>
      <p>Mean annual precipitation must be higher than 500mm 1990 -
      2020</p>
    </disp-quote>
    <p>Precipitation classified from 1-10 using a <bold>continuous
    function</bold> in ArcPro Suitability Mapper.</p>
    <p>NOTE: The logistic growth function may also be a good choice for
    this dataset. See
    <ext-link ext-link-type="uri" xlink:href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-analyst/the-transformation-functions-available-for-rescale-by-function.htm#ESRI_SECTION1_76ED0A2D02A24C95B98B8A691603F2F4">Logistic
    Growth function</ext-link></p>
    <table-wrap>
      <table>
        <colgroup>
          <col width="38%" />
          <col width="62%" />
        </colgroup>
        <thead>
          <tr>
            <th align="center">Parameter</th>
            <th align="center">Setting</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="center">Function</td>
            <td align="center"><ext-link ext-link-type="uri" xlink:href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-analyst/the-transformation-functions-available-for-rescale-by-function.htm#ESRI_SECTION1_B83C9047549542DE995823E6030A29F3">MSLarge</ext-link></td>
          </tr>
          <tr>
            <td align="center">Mean multiplier</td>
            <td align="center">1.68 (approximates 500mm at
            x-intercept)</td>
          </tr>
          <tr>
            <td align="center">Sddv multiplier</td>
            <td align="center">1</td>
          </tr>
          <tr>
            <td align="center">Lower threshold</td>
            <td align="center">67.33789825439453 (default, minimum)</td>
          </tr>
          <tr>
            <td align="center">Value below threshold</td>
            <td align="center">0</td>
          </tr>
          <tr>
            <td align="center">Upper threshold</td>
            <td align="center">1214.5689697265625 (default,
            maximum)</td>
          </tr>
          <tr>
            <td align="center">Value above threshold</td>
            <td align="center">0</td>
          </tr>
          <tr>
            <td align="center">Invert function</td>
            <td align="center">FALSE</td>
          </tr>
          <tr>
            <td align="center">Save transformed dataset</td>
            <td align="center">TRUE</td>
          </tr>
          <tr>
            <td align="center">Output</td>
            <td align="center">Transformed_PRISM_ppt_30yrnormal_800m</td>
          </tr>
        </tbody>
      </table>
    </table-wrap>
    <fig>
      <caption><p>Aspect suitability mapper rescale transformation
      setup.</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="images/SuitabilityAnalysis_Transformations/Precip_PRISM.png" />
    </fig>
  </sec>
  <sec id="vegetation-characteristics-nb-article">
    <title>2.3 Vegetation Characteristics</title>
    <sec id="nlcd-2021-total-canopy-cover-nb-article">
      <title>2.3.1 NLCD 2021 Total Canopy Cover</title>
    </sec>
    <sec id="landfire-nb-article">
      <title>2.3.2 Landfire</title>
    </sec>
  </sec>
  <sec id="soil-hydrology-nb-article">
    <title>2.4 Soil Hydrology</title>
    <p>AZ_Soil_Hydric_Group data layer</p>
    <p><bold>Classification Schema</bold></p>
    <table-wrap>
      <table>
        <colgroup>
          <col width="16%" />
          <col width="16%" />
          <col width="52%" />
          <col width="16%" />
        </colgroup>
        <thead>
          <tr>
            <th align="center">Class</th>
            <th align="center">Count (pixels)</th>
            <th align="center">Text</th>
            <th align="center">Value</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="center">A</td>
            <td align="center">62559472</td>
            <td align="center">Group A soils consist of deep, well
            drained sands or gravelly sands with high infiltration and
            low runoff rates.</td>
            <td align="center">10</td>
          </tr>
          <tr>
            <td align="center">B</td>
            <td align="center">76665198</td>
            <td align="center">Group B soils consist of deep well
            drained soils with a moderately fine to moderately coarse
            texture and a moderate rate of infiltration and runoff.</td>
            <td align="center">8</td>
          </tr>
          <tr>
            <td align="center">C</td>
            <td align="center">88491710</td>
            <td align="center">Group C consists of soils with a layer
            that impedes the downward movement of water or fine textured
            soils and a slow rate of infiltration.</td>
            <td align="center">5</td>
          </tr>
          <tr>
            <td align="center">D</td>
            <td align="center">155095790</td>
            <td align="center">Group D consists of soils with a very
            slow infiltration rate and high runoff potential. This group
            is composed of clays that have a high shrink-swell
            potential, soils with a high water table, soils that have a
            clay pan or clay layer at or near the surface, and soils
            that are shallow over nearly impervious material.</td>
            <td align="center">2</td>
          </tr>
          <tr>
            <td align="center">A/D</td>
            <td align="center">43192</td>
            <td align="center">Group A/D soils naturally have a very
            slow infiltration rate due to a high water table but will
            have high infiltration and low runoff rates if drained.</td>
            <td align="center">7</td>
          </tr>
          <tr>
            <td align="center">B/D</td>
            <td align="center">18456</td>
            <td align="center">Group B/D soils naturally have a very
            slow infiltration rate due to a high water table but will
            have a moderate rate of infiltration and runoff if
            drained.</td>
            <td align="center">6</td>
          </tr>
          <tr>
            <td align="center">C/D</td>
            <td align="center">217771</td>
            <td align="center">Group C/D soils naturally have a very
            slow infiltration rate due to a high water table but will
            have a slow rate of infiltration if drained.</td>
            <td align="center">3</td>
          </tr>
        </tbody>
      </table>
    </table-wrap>
    <p><italic>Transformed dataset</italic>
    Transformed_AZ_Soil_Hydric_Group</p>
  </sec>
  <sec id="depth-to-bedrock-nb-article">
    <title>2.5 Depth to Bedrock</title>
    <p><bold>There are 2 data layers which represent depth to bedrock
    and it is not clear which data layer is preferred!</bold></p>
    <list list-type="bullet">
      <list-item>
        <p>AZ_BedrockDepth_cm.tif</p>
        <list list-type="bullet">
          <list-item>
            <p>218 m resolution</p>
          </list-item>
          <list-item>
            <p>UTM 12N, NAVD88 depth (m) positive down</p>
          </list-item>
          <list-item>
            <p>0 – 108,273 cm</p>
          </list-item>
        </list>
      </list-item>
    </list>
    <fig>
      <caption><p>AZ_BedrockDepth_cm.tif with histogram.</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="images/Depth_to_Bedrock/AZ_BedrockDepth_cm.png" />
    </fig>
    <list list-type="bullet">
      <list-item>
        <p>Depth to Bedrock WTA</p>
        <list list-type="bullet">
          <list-item>
            <p>Classified</p>
          </list-item>
          <list-item>
            <p>30 m resolution</p>
          </list-item>
          <list-item>
            <p>UTM 12N, NAVD88 height (m) positive up</p>
            <list list-type="bullet">
              <list-item>
                <p>vertical datum is incorrect. Should be depth (m)
                positive down</p>
              </list-item>
            </list>
          </list-item>
          <list-item>
            <p>0 – 269 cm</p>
          </list-item>
          <list-item>
            <p>Extremely skewed distribution clustering around 200
            cm</p>
          </list-item>
        </list>
      </list-item>
    </list>
    <fig>
      <caption><p>Depth to Bedrock WTA, DEP2BEDRS_WTA layer with
      histogram</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="images/Depth_to_Bedrock/Depth_to_Bedrock_WTA.png" />
    </fig>
    <sec id="soil-vs.-subsurface-geology-weighting-layers-nb-article">
      <title>2.5.1 Soil vs. Subsurface Geology Weighting Layers</title>
      <p>To quantify the differential importance of soils vs. subsurface
      geology layers for determining suitability two related data layers
      had to be calculated.</p>
      <p>The logic assumes that there are two uniform subsurface layers,
      soil, and subsurface geology (i.e. geology). However, the weighted
      importance of these layers is not uniform across space. Where the
      bedrock is close to the surface, we assume that the soil is the
      most important layer for ground water storage. Inversely, when the
      bedrock is extremely deep, we assume that the geology is the more
      important layer. Our soil layer is measured at a depth of 200cm
      (2m), and we assume a uniform soil depth across the state.
      Therefore, the depth to bedrock was divided by 200 to get a depth
      to bedrock (dtb) in soil units. The first “soil depth” was
      ascribed to the soil layer, and varies from 0 to 1, while the
      remaining “soil depth” were attributed to the geology layer, with
      a range from 0 to 541. Ergo, where the bedrock is deepest, the
      geology layer is 541 time more influential than the soils
      layer.</p>
      <fig>
        <caption><p>Simple diagram of logic underlying the soil
        vs. subsurface geology weighting layers.</p></caption>
        <graphic mimetype="image" mime-subtype="jpeg" xlink:href="images/Depth_to_Bedrock/Notes.jpg" />
      </fig>
      <p>These layers were created in a custom R script using the
      following raster math, with their resulting outputs.</p>
      <sec id="soils-nb-article">
        <title>2.5.1.1 Soils</title>
        <code language="markdown">```{r}
# Where depth to bedrock (dtb) = 0cm, soil multiplier = 0 (no soil)
# Where depth to dtb &gt;= 200cm, soil multiplier = 1 (Full depth of soil)
# Intermediate depths = linear
soilMultiplier = masked
soilMultiplier[soilMultiplier &gt; 200] = 200  # Fix upper limit of soil depth = 200 cm
soilMultiplier = soilMultiplier/200
```</code>
        <fig>
          <caption><p>Soils multiplier layer.</p></caption>
          <graphic mimetype="image" mime-subtype="png" xlink:href="images/Depth_to_Bedrock/SoilsMultiplier.png" />
        </fig>
      </sec>
      <sec id="geology-nb-article">
        <title>2.5.1.2 Geology</title>
        <code language="markdown">```{r}
# Where dtb &lt; 200cm, geology multiplier = 0 (soil only)
# Where dtb &gt;= 200cm, geology multiplier = dtb/200 (in units of relative soil depth)
geologyMultiplier = masked
geologyMultiplier[geologyMultiplier &lt; 200] = 0
geologyMultiplier = geologyMultiplier/200
```</code>
        <fig>
          <caption><p>Geology multiplier layer.</p></caption>
          <graphic mimetype="image" mime-subtype="png" xlink:href="images/Depth_to_Bedrock/GeologyMultiplier.png" />
        </fig>
      </sec>
    </sec>
  </sec>
  <sec id="other-data-layers-for-consideration-nb-article">
    <title>2.6 Other Data Layers for Consideration</title>
    <sec id="global-hydrologic-curve-numbergcn250-nb-article">
      <title>2.6.1 Global Hydrologic Curve Number(GCN250)</title>
      <p>https://gee-community-catalog.org/projects/gcn250/?h=hydrologic</p>
      <disp-quote>
        <p>The GCN250 is a globally consistent, gridded dataset defining
        CNs at the <bold>250 m spatial resolution</bold> from new global
        land cover (300 m) and soils data (250 m). GCN250
        <bold>represents runoff</bold> for a combination of the European
        space agency global land cover dataset for 2015 (ESA CCI-LC)
        resampled to 250 m and geo-registered with the hydrologic soil
        group global data product (HYSOGs250m) released in 2018. The
        <bold>potential application</bold> of this data includes
        <bold>hydrologic design</bold>, land management applications,
        flood risk assessment, and <bold>groundwater recharge
        modeling</bold>. The CN values vary depending on antecedent
        runoff conditions (ARC), which is affected by the rainfall
        intensity and duration, total rainfall, soil moisture
        conditions, cover density, stage of growth, and temperature[.]
        <italic>emphasis mine</italic></p>
      </disp-quote>
    </sec>
    <sec id="soil-properties-800m-nb-article">
      <title>2.6.2 Soil Properties 800m</title>
      <p>https://gee-community-catalog.org/projects/soilprop/?h=</p>
      <disp-quote>
        <p>The data shown here were obtained by aggregating current
        USDA-NCSS soil survey data (SSURGO back-filled with STATSGO
        where SSURGO is not available) within <bold>800m² grid
        cells</bold>. This data aggregation technique results in maps
        that may not match the original data at any given point, and is
        <bold>intended to depict regional trends in soil properties at
        the statewide scale</bold>. <italic>emphasis mine</italic></p>
      </disp-quote>
      <list list-type="bullet">
        <list-item>
          <p>Pros:</p>
          <list list-type="bullet">
            <list-item>
              <p>Lots of relevant data layers, such as:</p>
              <list list-type="bullet">
                <list-item>
                  <p>Avail. Water Holding Capacity</p>
                </list-item>
                <list-item>
                  <p>Drainage Class</p>
                </list-item>
                <list-item>
                  <p>Sat. Hyd. Conductivity</p>
                </list-item>
                <list-item>
                  <p>Depth to Restrictive Layer</p>
                </list-item>
                <list-item>
                  <p>Hydrologic Group</p>
                </list-item>
                <list-item>
                  <p>Soil Depth</p>
                </list-item>
                <list-item>
                  <p>etc.</p>
                </list-item>
              </list>
            </list-item>
          </list>
        </list-item>
        <list-item>
          <p>Cons:</p>
          <list list-type="bullet">
            <list-item>
              <p>800m resolution</p>
            </list-item>
            <list-item>
              <p>Large data gaps (layer dependent)</p>
            </list-item>
          </list>
        </list-item>
      </list>
      <sec id="alternative-layers-nb-article">
        <title>2.6.2.1 Alternative layers</title>
        <p><ext-link ext-link-type="uri" xlink:href="https://gee-community-catalog.org/projects/gnatsgo/">gNATSGO
        (gridded National Soil Survey Geographic
        Database)</ext-link></p>
        <list list-type="bullet">
          <list-item>
            <p>Pros:</p>
            <list list-type="bullet">
              <list-item>
                <p>Authoritative</p>
              </list-item>
              <list-item>
                <p>Source layer for value added products (including Soil
                Properties 800m)</p>
              </list-item>
              <list-item>
                <p>10m resolution</p>
              </list-item>
            </list>
          </list-item>
          <list-item>
            <p>Cons:</p>
            <list list-type="bullet">
              <list-item>
                <p>Large data gaps across AZ</p>
              </list-item>
              <list-item>
                <p>10m resolution</p>
              </list-item>
            </list>
          </list-item>
        </list>
        <p><ext-link ext-link-type="uri" xlink:href="https://gee-community-catalog.org/projects/polaris/">Polaris
        30m Probabilistic Soil Properties US</ext-link></p>
        <list list-type="bullet">
          <list-item>
            <p>Pros:</p>
            <list list-type="bullet">
              <list-item>
                <p>Continuous data availability (no gaps)</p>
              </list-item>
              <list-item>
                <p>30m resolution</p>
              </list-item>
            </list>
          </list-item>
          <list-item>
            <p>Cons:</p>
            <list list-type="bullet">
              <list-item>
                <p>Fewer data layers</p>
              </list-item>
              <list-item>
                <p>Probabilistic model (increased uncertainty)</p>
              </list-item>
            </list>
          </list-item>
        </list>
      </sec>
    </sec>
    <sec id="leaf-area-index-lai-nb-article">
      <title>2.6.3 Leaf Area Index (LAI)</title>
      <p>Leaf Area Index (LAI) can be calculated from Landsat data (30 m
      resolution), as a proxy of land cover. LAI is a unitless index
      value which is calculated as a function of the Enhanced Vegetation
      Index (ENVI) and typically ranges from 0 to 3.5 (<italic>citation
      needed</italic>). LAI can be calculated efficiently over a large
      spatial scale in Google Earth Engine (GEE) using the Javascript
      API, however LAI will vary seasonally, with updated Landsat data
      available every 8-days. Additionally, due to our large study area,
      as well as the logistics of Landsat orbital paths, it takes 6 days
      to photograph the entire study area. Therefore, any LAI analysis
      on this scale will necessarily be a mosaic image, over roughly a
      week. For these reasons, a single LAI image should be viewed with
      some skepticism, and a seasonal mean or median LAI mosaic image
      may be more desireable as a proxy for land cover.</p>
      <p>Code is available for calculating LAI from Landsat 8/9 imagery
      in my personal GEE scripts folder, which could be easily modified
      for purpose. Due to the large number of Landsat images involved
      the study period must be narrowed prior to analysis (i.e. July
      LAI, Winter LAI, etc.). Additional post-processing of LAI images
      may be required outside of GEE.</p>
      <sec id="google-earth-engine-lai-javascript-code-nb-article">
        <title>2.6.3.1 Google Earth Engine LAI Javascript Code</title>
        <preformat>var studyArea = ee.FeatureCollection(&quot;projects/ee-travisz09/assets/ATUR/WBDHU8_OuterBoundary_Project&quot;),
    landsat9 = ee.ImageCollection(&quot;LANDSAT/LC09/C02/T1_TOA&quot;);

// Map setup
Map.centerObject(studyArea, 6);
Map.addLayer(studyArea, {}, 'Study Area', false);

// Paint study area outline
var empty = ee.Image().byte();  // An empty layer to paint on
var studyAreaOutline = empty.paint(studyArea, 'black', 2);
Map.addLayer(studyAreaOutline, {}, 'Study Area (outline)');

// Study period
var startDate = ee.Date('2023-01-01');
var endDate = ee.Date('2024-01-01');  // Exclusive end date
var timeDif = endDate.difference(startDate, 'day');
// var interval = 8;  // days
// print(timeDif);

// Landsat 8/9
var cloudFilter = 10  // 10% max cloud cover
var landsat = ee.ImageCollection('LANDSAT/LC08/C02/T1_L2')
  .merge(ee.ImageCollection('LANDSAT/LC09/C02/T1_L2'))  // Combine Lst-9 and Lst-8
  .filterDate(startDate, endDate)
  .filterBounds(studyArea)
  .sort('system:time_start')  // Sort by date
  .filter(ee.Filter.lt('CLOUD_COVER', cloudFilter));
  
// Lst scaling factor function
var scaleLst = function(col) {
  // Map over images in collection
  var scaled = col.map(function(img) {
    var opticalBands = img.select('SR_B.').multiply(0.0000275).add(-0.2);
    var thermalBands = img.select('ST_B.*').multiply(0.00341802).add(149.0);
    
    return img.addBands(opticalBands, null, true)  // Overwrite unscaled bands
      .addBands(thermalBands, null, true);
  });
  
  return scaled;
};

// print(landsat.first());  // Check the Lst data before scaling
landsat = scaleLst(landsat);  // Apply scaling factor
// print(landsat.first());  // Check Lst data after scaling

// NDVI, EVI, LAI, index function
var calcIndices = function(col) {
  var indices = col.map(function(img) {
    var ndvi = img.normalizedDifference(['SR_B5', 'SR_B4'])
      .rename('ndvi');
    var evi = img.expression(
      '2.5 * ((nir - red) / (nir + 6 * red - 7.5 * blue + 1))',
      {
        'nir': img.select('SR_B5'),
        'red': img.select('SR_B4'),
        'blue': img.select('SR_B2')
      }).rename('evi');
    var lai = evi.expression(
      '3.618 * evi - 0.118', 
      {
        'evi': evi.select('evi')
      }).rename('lai');
      
    return img.addBands(ndvi)
      .addBands(evi)
      .addBands(lai);
  });
  
  return indices;
};

// Apply indices
landsat = calcIndices(landsat);
// print(landsat.first());  // sanity check

// Isolate lai bands
var lai = landsat.map(function(img) {
  return img.select('lai');
});

Map.addLayer(lai.limit(20), {
  min: 0,
  max: 3.5,
  palette: ['red', 'white', 'green']
}, 'LAI');
print(lai);</preformat>
      </sec>
    </sec>
  </sec>
</sec>
<sec id="sec-conclusions-nb-article">
  <title>3 Conclusion</title>
</sec>
<sec id="references-nb-article">
  <title>References</title>
</sec>
</body>



<back>
</back>


</sub-article>
<sub-article article-type="notebook" id="nb-4-nb-1">
<front-stub>
<title-group>
<article-title>Data Screening</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">0000-0002-0760-5497</contrib-id>
<name>
<surname>Purves</surname>
<given-names>Steve</given-names>
</name>
<string-name>Steve Purves</string-name>

</contrib>
<contrib contrib-type="author">
<name>
<surname>Wickham</surname>
<given-names>Charlotte</given-names>
</name>
<string-name>Charlotte Wickham</string-name>

<xref ref-type="author-note" rid="auth-note-2-nb-1">2</xref>
</contrib>
</contrib-group>
<author-notes>
<fn id="auth-note-2-nb-1" fn-type="author-note" symbol="2">Edited original
notebook by Steve Purves</fn>
</author-notes>
</front-stub>

<body>
<sec id="cell-25276572-nb-1" specific-use="notebook-content">
<preformat>import pandas as pd
import matplotlib.pyplot as plt</preformat>
</sec>
<sec id="cell-7f05db89-nb-1" specific-use="notebook-content">
<p>Import <monospace>la-palma.csv</monospace> - a clean subset of
<ext-link ext-link-type="uri" xlink:href="https://github.com/Notebooks-Now/submission-quarto-full/blob/main/data/catalogoComunSV_1663233588717.csv"><monospace>catalogoComunSV_1663233588717.csv</monospace></ext-link>:</p>
</sec>
<sec id="da2659e5-nb-1" specific-use="notebook-content">
<preformat>df = pd.read_csv('la-palma.csv')
df['DateTime'] = pd.to_datetime(df['DateTime'])
df = df.sort_values(by=['DateTime'], ascending=True)
df.head()</preformat>
<boxed-text>
  <table-wrap>
    <table border="1">
      <thead>
        <tr style="text-align: right;">
          <th></th>
          <th>Longitude</th>
          <th>Latitude</th>
          <th>Depth(km)</th>
          <th>Magnitude</th>
          <th>DateTime</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>11346</td>
          <td>-17.8349</td>
          <td>28.5346</td>
          <td>26.0</td>
          <td>1.6</td>
          <td>2017-03-09 23:44:06+00:00</td>
        </tr>
        <tr>
          <td>11343</td>
          <td>-17.8459</td>
          <td>28.5491</td>
          <td>27.0</td>
          <td>2.0</td>
          <td>2017-03-10 00:16:10+00:00</td>
        </tr>
        <tr>
          <td>11344</td>
          <td>-17.8863</td>
          <td>28.5008</td>
          <td>20.0</td>
          <td>2.1</td>
          <td>2017-03-10 00:16:11+00:00</td>
        </tr>
        <tr>
          <td>11345</td>
          <td>-17.8657</td>
          <td>28.5204</td>
          <td>30.0</td>
          <td>1.6</td>
          <td>2017-03-10 03:20:26+00:00</td>
        </tr>
        <tr>
          <td>11342</td>
          <td>-17.7156</td>
          <td>28.5985</td>
          <td>0.0</td>
          <td>1.6</td>
          <td>2017-08-21 02:06:55+00:00</td>
        </tr>
      </tbody>
    </table>
  </table-wrap>
</boxed-text>
</sec>
<sec id="ae1253df-nb-1" specific-use="notebook-content">
<preformat>df.describe()</preformat>
<boxed-text>
  <table-wrap>
    <table border="1">
      <thead>
        <tr style="text-align: right;">
          <th></th>
          <th>Longitude</th>
          <th>Latitude</th>
          <th>Depth(km)</th>
          <th>Magnitude</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>count</td>
          <td>11347.000000</td>
          <td>11347.000000</td>
          <td>11347.000000</td>
          <td>11347.000000</td>
        </tr>
        <tr>
          <td>mean</td>
          <td>-17.844062</td>
          <td>28.568893</td>
          <td>14.089345</td>
          <td>2.432423</td>
        </tr>
        <tr>
          <td>std</td>
          <td>0.027345</td>
          <td>0.021899</td>
          <td>8.624787</td>
          <td>0.705282</td>
        </tr>
        <tr>
          <td>min</td>
          <td>-17.995800</td>
          <td>28.310200</td>
          <td>0.000000</td>
          <td>0.200000</td>
        </tr>
        <tr>
          <td>25%</td>
          <td>-17.854100</td>
          <td>28.558000</td>
          <td>10.100000</td>
          <td>1.900000</td>
        </tr>
        <tr>
          <td>50%</td>
          <td>-17.838700</td>
          <td>28.564000</td>
          <td>11.300000</td>
          <td>2.600000</td>
        </tr>
        <tr>
          <td>75%</td>
          <td>-17.829700</td>
          <td>28.574300</td>
          <td>13.900000</td>
          <td>2.900000</td>
        </tr>
        <tr>
          <td>max</td>
          <td>-17.705700</td>
          <td>28.697800</td>
          <td>46.900000</td>
          <td>5.100000</td>
        </tr>
      </tbody>
    </table>
  </table-wrap>
</boxed-text>
</sec>
<sec id="cell-81b4dfb2-nb-1" specific-use="notebook-content">
<preformat>df.plot.scatter(x=&quot;Longitude&quot;, y=&quot;Latitude&quot;, figsize=(12,12), grid=&quot;on&quot;);</preformat>
<boxed-text>
  <graphic mimetype="image" mime-subtype="png" xlink:href="data-screening_files/figure-jats/cell-5-output-1.png" />
</boxed-text>
</sec>
<sec id="cell-19a1ba0d-nb-1" specific-use="notebook-content">
<sec id="filter-nb-1">
  <title>Filter</title>
  <p>Also some rows seem to be missing depth measurements, (see
  differences in the <bold>count</bold> for columns above) - take only
  rows with valid depths</p>
  </sec>
  <sec id="e56a69b3-nb-1" specific-use="notebook-content">
  <preformat>df = df[df['Depth(km)'].notna()]
df.describe()</preformat>
  <boxed-text>
    <table-wrap>
      <table border="1">
        <thead>
          <tr style="text-align: right;">
            <th></th>
            <th>Longitude</th>
            <th>Latitude</th>
            <th>Depth(km)</th>
            <th>Magnitude</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>count</td>
            <td>11347.000000</td>
            <td>11347.000000</td>
            <td>11347.000000</td>
            <td>11347.000000</td>
          </tr>
          <tr>
            <td>mean</td>
            <td>-17.844062</td>
            <td>28.568893</td>
            <td>14.089345</td>
            <td>2.432423</td>
          </tr>
          <tr>
            <td>std</td>
            <td>0.027345</td>
            <td>0.021899</td>
            <td>8.624787</td>
            <td>0.705282</td>
          </tr>
          <tr>
            <td>min</td>
            <td>-17.995800</td>
            <td>28.310200</td>
            <td>0.000000</td>
            <td>0.200000</td>
          </tr>
          <tr>
            <td>25%</td>
            <td>-17.854100</td>
            <td>28.558000</td>
            <td>10.100000</td>
            <td>1.900000</td>
          </tr>
          <tr>
            <td>50%</td>
            <td>-17.838700</td>
            <td>28.564000</td>
            <td>11.300000</td>
            <td>2.600000</td>
          </tr>
          <tr>
            <td>75%</td>
            <td>-17.829700</td>
            <td>28.574300</td>
            <td>13.900000</td>
            <td>2.900000</td>
          </tr>
          <tr>
            <td>max</td>
            <td>-17.705700</td>
            <td>28.697800</td>
            <td>46.900000</td>
            <td>5.100000</td>
          </tr>
        </tbody>
      </table>
    </table-wrap>
  </boxed-text>
  </sec>
  <sec id="cell-1368822d-nb-1" specific-use="notebook-content">
  <preformat>plt.figure(figsize=(20,6))
plt.subplot(1,3,1)
df[&quot;Latitude&quot;].plot.hist(bins=20, density=True)
plt.subplot(1,3,2)
df[&quot;Longitude&quot;].plot.hist(bins=20, density=True)
plt.subplot(1,3,3)
df[&quot;Depth(km)&quot;].plot.hist(bins=50, density=True)</preformat>
  <boxed-text>
    <graphic mimetype="image" mime-subtype="png" xlink:href="data-screening_files/figure-jats/cell-7-output-1.png" />
  </boxed-text>
  </sec>
  <sec id="da7ad095-nb-1" specific-use="notebook-content">
</sec>
<sec id="spatial-plot-nb-1">
  <title>Spatial Plot</title>
  <p>Scatter plot the spatial locations of events</p>
  </sec>
  <sec id="cell-fig-spatial-plot-nb-1" specific-use="notebook-content">
  <preformat>#| label: fig-spatial-plot
#| fig-cap: Locations of earthquakes on La Palma since 2017.
#| fig-alt: A scatterplot of earthquake locations plotting latitude against longitude.
from matplotlib import colormaps
cmap = colormaps['viridis_r']
ax = df.plot.scatter(x=&quot;Longitude&quot;, y=&quot;Latitude&quot;, 
                     s=47-df[&quot;Depth(km)&quot;], c=df[&quot;Magnitude&quot;], 
                     figsize=(12,10), grid=&quot;on&quot;, cmap=cmap)
colorbar = ax.collections[0].colorbar
colorbar.set_label(&quot;Magnitude&quot;)

plt.show()</preformat>
  <boxed-text>
    <fig id="fig-spatial-plot-nb-1">
      <caption><p>Locations of earthquakes on La Palma since
      2017.</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="data-screening_files/figure-jats/fig-spatial-plot-output-1.png" />
    </fig>
  </boxed-text>
  </sec>
  <sec id="cell-22ac5ce7-nb-1" specific-use="notebook-content">
  <sec id="timeline-plot-nb-1">
    <title>Timeline Plot</title>
    <p>Scatter plot the event time series and look for any quantization
    issues. Have times &amp; dates been loaded correctly?</p>
    <p>ax = df.plot.scatter(x=‘DateTime’, y=‘Depth(km)’, figsize=(20,8))
    ax.set_ylim(50,0);</p>
    </sec>
  </sec>
</sec>
</body>



<back>
</back>


</sub-article>

</article>